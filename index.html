<!DOCTYPE html>
<html lang="en">

<!-- =============================================
     HEAD SECTION
     Contains meta information, styles, and external resources
============================================== -->

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Legal Document Summarizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Import Google Font - Inter */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        .container {
            max-width: 800px;
        }

        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .summary-container {
            min-height: 200px;
            background-color: #e5e7eb;
            color: #4b5563;
        }

        .file-upload-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-upload-wrapper input[type="file"] {
            font-size: 100px;
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            cursor: pointer;
        }

        .prose {
            color: #4b5563;
        }

        /* New custom CSS for summary output */
        .prose ul li:before {
            content: '•';
            display: inline-block;
            width: 1em;
            margin-left: -1em;
            color: #3b82f6;
            /* Blue bullet */
        }

        .prose ul,
        .prose ol {
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .prose li {
            line-height: 1.5;
            margin-bottom: 0.5rem;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js';
    </script>
</head>

<!-- =============================================
     BODY SECTION
     Contains the main application interface
============================================== -->

<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
    <!-- Main Container -->
    <div class="container bg-white p-8 rounded-2xl shadow-xl space-y-6">
        <h1 class="text-4xl font-bold text-gray-800 text-center mb-2">Legal Document Summarizer</h1>
        <p class="text-gray-500 text-center text-sm mb-6">
            Upload a legal document in PDF format to get a concise summary.
            <br>The AI will focus on key provisions, clauses, and implications within the Indian legal context.
        </p>
        <div class="space-y-4">
            <div>
                <label for="pdf-file" class="block text-sm font-medium text-gray-700 mb-1">Upload a PDF Document</label>
                <div class="file-upload-wrapper w-full mt-1">
                    <button id="upload-btn"
                        class="w-full flex items-center justify-center py-3 px-6 border border-gray-300 rounded-xl text-base font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200 cursor-pointer">
                        <span id="file-name">No file selected</span>
                    </button>
                    <input id="pdf-file" type="file" accept="application/pdf"
                        class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
                </div>
            </div>
            <button id="summarize-btn"
                class="w-full flex items-center justify-center py-3 px-6 border border-transparent rounded-xl shadow-sm text-base font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200"
                disabled>
                <span id="button-text">Summarize Document</span>
                <div id="loader" class="loader ml-3 hidden"></div>
            </button>
        </div>
        <div class="space-y-4 pt-4">
            <h2 class="text-2xl font-semibold text-gray-800">Summary</h2>
            <div id="summary-output" class="summary-container rounded-xl p-4 shadow-inner text-sm overflow-auto">
                <p class="text-gray-500 text-center">Your summary will appear here.</p>
            </div>
            <div id="copy-btn"
                class="w-full flex items-center justify-center py-3 px-6 border border-transparent rounded-xl shadow-sm text-base font-medium text-white bg-gray-600 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors duration-200 cursor-pointer hidden">
                <span id="copy-text">Copy Summary</span>
            </div>
            <div id="error-container"
                class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative" role="alert">
                <span id="error-message" class="block sm:inline"></span>
            </div>
            <div id="status-message" class="text-center text-sm text-gray-600 mt-4 hidden"></div>
        </div>
    </div>
    <!-- =============================================
         JAVASCRIPT SECTION
         Contains the application logic
    ============================================== -->
    <script>
        // ===== CONFIGURATION =====
        const API_KEY = 'your_api_key_here'; // Replace with your actual API key
        const API_ENDPOINT = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${API_KEY}`;
        const fileInput = document.getElementById('pdf-file');
        const summarizeBtn = document.getElementById('summarize-btn');
        const copyBtn = document.getElementById('copy-btn');
        const copyText = document.getElementById('copy-text');
        const fileNameSpan = document.getElementById('file-name');
        const buttonText = document.getElementById('button-text');
        const loader = document.getElementById('loader');
        const summaryOutput = document.getElementById('summary-output');
        const errorContainer = document.getElementById('error-container');
        const errorMessage = document.getElementById('error-message');
        const statusMessage = document.getElementById('status-message');

        // Global variable to store PDF text
        let pdfText = '';

        // ===== FILE HANDLING =====
        // Handle file upload and validation
        fileInput.addEventListener('change', async function (e) {
            const file = e.target.files[0];
            if (!file) {
                summarizeBtn.disabled = true;
                fileNameSpan.textContent = 'No file selected';
                return;
            }
            if (file.type !== 'application/pdf') {
                showError('Please upload a PDF file.');
                summarizeBtn.disabled = true;
                fileNameSpan.textContent = 'No file selected';
                return;
            }
            fileNameSpan.textContent = file.name;
            hideError();
            try {
                statusMessage.textContent = 'Reading PDF...';
                statusMessage.classList.remove('hidden');
                pdfText = await extractTextFromPDF(file);
                if (pdfText.length === 0) {
                    showError('Could not extract text from the PDF. The file may be an image scan.');
                    summarizeBtn.disabled = true;
                } else {
                    summarizeBtn.disabled = false;
                    statusMessage.textContent = 'PDF loaded successfully. Ready to summarize.';
                }
            } catch (error) {
                showError('Error reading PDF file: ' + error.message);
                summarizeBtn.disabled = true;
            }
        });

        // ===== PDF PROCESSING =====
        // Extract text from PDF using PDF.js
        async function extractTextFromPDF(file) {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
            let text = '';
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const content = await page.getTextContent();
                text += content.items.map(item => item.str).join(' ');
            }
            return text;
        }

        // ===== SUMMARY GENERATION =====
        // Handle summarize button click
        summarizeBtn.addEventListener('click', async function () {
            if (!pdfText) {
                showError('Please upload and process a PDF file first.');
                return;
            }
            setLoading(true);
            hideError();
            statusMessage.textContent = 'Generating summary...';
            statusMessage.classList.remove('hidden');
            copyBtn.classList.add('hidden');
            try {
                const summary = await generateSummary(pdfText);
                summaryOutput.innerHTML = `<div class="prose">${marked.parse(summary)}</div>`;
                statusMessage.textContent = 'Summary generated successfully.';
                copyBtn.classList.remove('hidden');
            } catch (error) {
                showError('Error generating summary: ' + error.message);
                summaryOutput.innerHTML = '<p class="text-gray-500 text-center">Failed to generate summary.</p>';
            } finally {
                setLoading(false);
            }
        });

        // ===== COPY FUNCTIONALITY =====
        // Handle copy button click
        copyBtn.addEventListener('click', function () {
            const summaryText = summaryOutput.innerText;

            // Use execCommand('copy') as a fallback for the clipboard API
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = summaryText;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();

            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    copyText.textContent = 'Copied!';
                } else {
                    copyText.textContent = 'Failed to copy';
                }
            } catch (err) {
                console.error('Failed to copy text using execCommand: ', err);
                copyText.textContent = 'Failed to copy';
            }

            document.body.removeChild(tempTextArea);

            setTimeout(() => {
                copyText.textContent = 'Copy Summary';
            }, 2000);
        });

        // ===== AI INTEGRATION =====
        // Generate summary using Gemini AI
        async function generateSummary(text) {
            const systemPrompt = `You are a highly experienced and meticulous legal analyst with a deep specialization in Indian jurisprudence. Your expertise spans corporate law, intellectual property, constitutional law, and the civil and criminal codes of India, including both the Indian Penal Code (IPC) and the Bharatiya Nyaya Sanhita (BNS), as well as the Criminal Procedure Code (CrPC) and the Bharatiya Nagarik Suraksha Sanhita (BNSS).

Your primary function is to analyze and provide a concise, accurate, and factually grounded summary of the legal document provided by the user.

The summary must be structured clearly using Markdown headings and must contain the following sections (in this order):

## Document Overview
- A high‑level summary of the document’s purpose, legal type (e.g., judgment, contract, affidavit), and the primary parties involved.

## Procedural History *(mandatory for judgments)*
- A chronological outline of key procedural steps: filings, hearings, orders, appeals, and relevant dates.

## Key Provisions and Clauses
- A bulleted list of the most critical legal provisions, clauses, and obligations found in the document.
- For judgments, include the statutory provisions applied and the issues framed.

## Court’s Reasoning *(mandatory for judgments)*
- A clear, step‑by‑step breakdown of the court’s analysis and application of law to facts.
- Highlight distinctions made (e.g., annulment vs. cancellation of bail) and any tests applied (e.g., “prejudice” test for procedural lapses).

## Relief Granted / Final Order *(mandatory for judgments)*
- The operative part of the decision, including directions, penalties, or remedies.

## Legal Precedents and References
- A list of Indian Acts, sections, rules, and relevant case law cited in the document.
- Group precedents by theme (e.g., bail principles, procedural safeguards) where possible.

## Implications and Consequences
- An analysis of the key legal implications, consequences, and actionable insights for the parties involved.
- For judgments, note broader jurisprudential impact, procedural clarifications, or policy implications.

## Disclaimer
A final, mandatory statement:
"This is a generative AI summary of an Indian legal document and should not be considered legal advice. Please consult a qualified advocate or legal professional licensed to practise in India for any legal matters."

---

**Rules and Constraints:**
1. **Source Fidelity** – Base all content strictly on the provided text. Do not invent facts, provisions, or legal arguments. If a fact is missing or unclear, explicitly state this.
2. **Citation Handling** – Quote directly only when necessary for precision, enclosing in double quotes, and indicate paragraph/page if available. Do not complete partial citations from memory.
3. **Jurisdictional Accuracy** – Interpret procedural references in the context of Indian law, noting whether provisions are pre‑ or post‑BNSS/BNS. Briefly explain constitutional provisions where cited.
4. **Clarity & Accessibility** – Use plain English for complex legal concepts while retaining essential legal terms. Avoid unnecessary jargon.
5. **No Speculation** – If the document contains conflicting or incomplete information, note it without resolving it.
6. **Self‑Containment** – Ensure the summary can be understood without access to the original document.
7. **Tone** – Maintain a formal, professional, and objective tone throughout.
8. **Examples** – Where appropriate, illustrate legal principles with brief examples drawn from the case facts (without adding new facts).`;

            const userQuery = `Summarize the following document for an expert legal audience.

                Document:
                ---
                ${text}
                ---

                Summary:`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                tools: [{ "google_search": {} }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            let response = null;
            let retryCount = 0;
            const maxRetries = 5;
            const baseDelay = 1000;

            while (retryCount < maxRetries) {
                try {
                    response = await fetch(API_ENDPOINT, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.status === 429) {
                        const delay = baseDelay * Math.pow(2, retryCount);
                        console.warn(`Rate limit exceeded. Retrying in ${delay / 1000}s...`);
                        await new Promise(resolve => setTimeout(resolve, delay));
                        retryCount++;
                        continue;
                    }
                    if (!response.ok) {
                        throw new Error(`API call failed with status: ${response.status}`);
                    }
                    break;
                } catch (error) {
                    if (retryCount >= maxRetries - 1) throw error;
                    const delay = baseDelay * Math.pow(2, retryCount);
                    console.error(`API call failed. Retrying in ${delay / 1000}s...`, error);
                    await new Promise(resolve => setTimeout(resolve, delay));
                    retryCount++;
                }
            }
            if (!response) {
                throw new Error('API call failed after multiple retries.');
            }
            const result = await response.json();
            const candidate = result.candidates?.[0];
            let summaryText = "Sorry, no summary could be generated. Please try again or with a different document.";
            if (candidate && candidate.content?.parts?.[0]?.text) {
                summaryText = candidate.content.parts[0].text;
                const groundingMetadata = candidate.groundingMetadata;
                const sources = [];
                if (groundingMetadata && groundingMetadata.groundingAttributions) {
                    groundingMetadata.groundingAttributions.forEach(attribution => {
                        if (attribution.web?.uri && attribution.web?.title) {
                            sources.push({
                                uri: attribution.web.uri,
                                title: attribution.web.title
                            });
                        }
                    });
                }
                if (sources.length > 0) {
                    const sourceList = sources.map(source => `<li class="break-words"><a href="${source.uri}" target="_blank" class="text-blue-500 hover:underline">${source.title}</a></li>`).join('');
                    summaryText += `<br><br><div class="border-t border-gray-300 pt-4 mt-4">
                                        <h3 class="text-sm font-semibold text-gray-700">Sources used for grounding:</h3>
                                        <ul class="list-disc pl-5 text-xs text-gray-600 mt-2">${sourceList}</ul>
                                    </div>`;
                }
            }
            return summaryText;
        }

        // ===== UI HELPER FUNCTIONS =====
        // Set loading state
        function setLoading(isLoading) {
            summarizeBtn.disabled = isLoading;
            buttonText.textContent = isLoading ? 'Processing...' : 'Summarize Document';
            loader.classList.toggle('hidden', !isLoading);
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorContainer.classList.remove('hidden');
            statusMessage.classList.add('hidden');
        }

        function hideError() {
            errorContainer.classList.add('hidden');
            errorMessage.textContent = '';
        }
    </script>
</body>

</html>